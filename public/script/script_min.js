!function t(n,e,r){function o(a,u){if(!e[a]){if(!n[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(i)return i(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var s=e[a]={exports:{}};n[a][0].call(s.exports,function(t){var e=n[a][1][t];return o(e?e:t)},s,s.exports,t,n,e,r)}return e[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,n,e){var r=t("client/fiat"),o=t("client/i18n"),i=t("map"),a=t("map/tiles"),u=t("geometry/tools"),c=t("./client/browser");o.initialize(function(t){return t?console.error(t):void r.onReady(function(){var t=i.create(),n=a.layer(a.providers.MAPQUEST);t.addLayer(n),t.container.onAttached(function(){var n=(u.fromGeoJson({type:"Envelope",coordinates:[[11.274513045933933,50.064726311348174],[11.636284907126422,50.133499050947165]]}),u.fromGeoJson({type:"Envelope",coordinates:[[7.663104262751075,49.420316720969126],[7.871519041616732,49.46372382507342]]}));t.goToGeo(n)}),r.body.append(t.container.style({width:"100%",height:"100%"})),c.start(t)})})},{"./client/browser":2,"client/fiat":5,"client/i18n":6,"geometry/tools":13,map:15,"map/tiles":16}],2:[function(t,n,e){var r=t("commons/colors"),o=t("map/designer"),i=t("client/ajax"),a=t("geometry"),u=t("client/fiat");e.start=function(t){var n=.12,e=u.node("div").style({position:"fixed",left:cm(n),top:cm(n),bottom:cm(n),borderRadius:cm(n),padding:cm(n),backgroundColor:colors.dark}),r=u.node("textarea").style({width:"100%",height:"100%",fontFamily:fonts.mono,borderRadius:cm(n),border:"none",resize:"horizontal",padding:cm(n)}),i=o.layer();t.addLayer(i),r.on("input",function(){g()});var a,g=function(){a&&clearTimeout(a),a=setTimeout(d,200)},d=function(){var t=r.value(),n=f(t);c(n,function(e){return e?console.error(e):(i.clear(),s(t,n,i),void l(t,n,i))})};u.body.append(e.append(r))};var c=function(t,n){var e=g(t);return e.length?void i.post("/api/nodes").attach({ids:e}).onFailure(n).onSuccess(function(e){return e=JSON.parse(e),e.nodes.forEach(function(n){var e=n.id.substr(5);t[e]=n}),n()}).send():n()},f=function(t){t=t.replace(/[^0-9]/g,",");var n=t.split(","),e={};return n.forEach(function(t){t&&t.length&&(e[t]=!0)}),e},s=function(t,n,e){var r=t.match(/\[[^\[\]]+\]/g);r&&r.forEach(function(t){var r=t.replace(/[^0-9]/g,",").split(",").filter(d);if(r&&!(r.length<2)){var o=a.Path.create();r.forEach(function(t){o.lineTo(n[t].location)}),h(o,e),e.addGeometry(o)}})},l=function(t,n,e){var r=t.replace(/\[[^\[\]]+\]/g,"").replace(/[^0-9]/g,",").split(",").filter(d);r.forEach(function(t){var r=n[t].location;h(r,e),e.addGeometry(r)})},g=function(t){var n=[];for(var e in t)n.push(e);return n},d=function(t){return t&&t.length},h=function(t,n){var e;t.color="#303030",t.onOver=function(){e=t.color,t.color="#ffaa55",n.triggerUpdate()},t.onOut=function(){t.color=e,n.triggerUpdate()},t.onTap=function(){e=r.random(),t.color=e,n.triggerUpdate()}}},{"client/ajax":3,"client/fiat":5,"commons/colors":9,geometry:12,"map/designer":14}],3:[function(t,n,e){var r=t("./log"),o=function(t,n){var e,o,u,c=r.info,f=r.error,s=new XMLHttpRequest;s.open(t,n,!0);var l={};return l.attach=function(t,n){return void 0!=n?(e=t,n&&s.setRequestHeader("Content-Type",n)):(e=JSON.stringify(t),s.setRequestHeader("Content-Type","application/json; charset=UTF8")),l},l.header=function(t,n){return s.setRequestHeader(t,n),l},l.onSuccess=function(t){return c=t,l},l.onFailure=function(t){return f=t,l},l.onDownloadProgress=function(t){return u=t,l},l.onUploadProgress=function(t){return o=t,l},l.send=function(){return o&&i(s,o),u&&a(s,u),s.send(e),l},l.cancel=function(){return s.abort(),l},s.onreadystatechange=function(){var t=s.readyState;4==t&&(200==s.status?c&&c(s.responseText,s):f&&f(s.statusText,s))},l},i=function(t,n){t.upload.addEventListener("progress",function(t){var e=t.lengthComputable?t.loaded/t.total:void 0;n(e)},!1)},a=function(t,n){t.addEventListener("progress",function(t){var e=t.lengthComputable?t.loaded/t.total:void 0;n(e)},!1)};n.exports={request:o,post:function(t){return o("POST",t)},get:function(t){return o("GET",t)}}},{"./log":7}],4:[function(t,n,e){var r=t("commons/colors"),o=t("commons"),i=function(t,n,e){return t+(n-t)*e},a=function(t){var n,e,r,a,u,c,f=t.easing||k,s=t.interpolate||i,l=t.duration||300,g=function(){u=!0,t.onDone&&t.onDone()},d=function(){if(a)t.onCanceled&&t.onCanceled();else{var o=(new Date).getTime(),i=Math.min(1,(o-n)/l),u=f(i),h=s(e,r,u);if(t.onTick(h,n,o),c=i>=1,!c)return void window.requestAnimationFrame(d);t.onComplete&&t.onComplete()}g()},h=function(){return n=(new Date).getTime(),e=isFunction(t.from)?t.from():t.from,r=isFunction(t.to)?t.to():t.to,o.equals(e,r)?window.requestAnimationFrame(function(){c=!0,t.onComplete&&t.onComplete(),g()}):(e.unit!=r.unit&&console.log("warning: animating from "+e.unit+" to "+r.unit),void window.requestAnimationFrame(d))};return h(),{isDone:function(){return u},isComplete:function(){return c},cancel:function(){a=!0}}},u=function(t){var n,e,r,o,i=function(){if(e)t.onCanceled&&t.onCanceled();else{var r=(new Date).getTime();if(o=t.doLoop(r,n),!o)return window.requestAnimationFrame(i);t.onComplete&&t.onComplete()}t.onDone&&t.onDone()},a=function(){n=(new Date).getTime(),window.requestAnimationFrame(i)};return a(),{cancel:function(){e=!0},isDone:function(){return r},isComplete:function(){return o}}},c=function(t,n,e){e=e||{};var r=f(t,n);if(e.onTick){var o=e.onTick,i=r.onTick;delete e.onTick,r.onTick=function(){i.apply(this,arguments),o.apply(this,arguments)}}for(var a in e)r[a]=e[a];return P(r)},f=function(t,n){var e=[];for(var r in n){var o=n[r];e.push(s(t,r,o))}var i=e.length;return{from:function(){for(var t=0;i>t;t++){var n=e[t];n.from=isFunction(n.from)?n.from():n.from}return 0},to:function(){for(var t=0;i>t;t++){var n=e[t];n.to=isFunction(n.to)?n.to():n.to}return 1},onTick:function(t){for(var n=0;i>n;n++){var r=e[n],o=r.interpolate(r.from,r.to,t);r.onTick(o)}}}},s=function(t,n,e){var r=T(n);return{from:function(){if(O(e)&&"from"in e){var n=isFunction(e.from)?e.from():e.from;return r.parse(n)}return r.get(t)},to:function(){if(O(e)&&"to"in e){var t=isFunction(e.to)?e.to():e.to;return r.parse(t)}return r.parse(e)},interpolate:function(t,n,e){return r.interpolate(t,n,e)},onTick:function(n){r.set(t,n)}}},l=function(t,n,e){var r={};return{get:function(r){var o=r[n](t);return void 0==o?{value:e.value,unit:e.unit}:d(o,e.unit)},parse:function(t){return d(t,e.unit)},set:function(e,r){value=r.unit?r.value+r.unit:r.value,e[n](t,value)},interpolate:function(t,n,e){return r.value=t.value+(n.value-t.value)*e,r.unit=n.unit,r}}},g=function(t){var n=r.rgb();return{get:function(n){var e=n.style(t);return r.parseRgb(e)||r.rgb()},parse:function(t){return r.parseRgb(t)||r.rgb()},set:function(n,e){n.style(t,e.toString())},interpolate:function(t,e,r){return n.r=Math.round(t.r+(e.r-t.r)*r),n.g=Math.round(t.g+(e.g-t.g)*r),n.b=Math.round(t.b+(e.b-t.b)*r),n.a=t.a+(e.a-t.a)*r,n}}},d=function(t,n){if(isString(t)){var e=t.search(/[^0-9\-\.\+]/);return e>0?{value:parseFloat(t.substr(0,e)),unit:t.substr(e)}:{value:parseFloat(t),unit:n}}return{value:t,unit:n}},h=function(t){return l(t,"style",{value:0,unit:"px"})},v=function(t){return l(t,"transform",{value:1,unit:!1})},p=function(){return l("rotate","transform",{value:0,unit:"deg"})},m=function(){return l("opacity","style",{value:1,unit:!1})},y={width:h,height:h,bottom:h,top:h,left:h,right:h,x:h,y:h,backgroundColor:g,borderColor:g,color:g,scaleX:v,scaleY:v,rotate:p,opacity:m,margin:h,padding:h,marginTop:h,marginLeft:h,marginRight:h,marginBottom:h},T=function(t){var n=y[t];if(!n)throw"the property "+t+" can not be animated yet.";return n(t)},x=function(){var t,n=[],e=function(e,o){n.push({object:e,parameters:o}),t||r()},r=function(){var e=n.shift(),r=e.object,i=e.parameters;t=r.animate(i,{onDone:o})},o=function(){t=null,n.length&&r()};return e},M=function(t,n,e){var r,o=setTimeout(function(){o=null,r=t.apply(this,n)},e);return{cancel:function(){r?r.cancel():clearTimeout(o)},isDone:function(){return r&&r.isDone()},isComplete:function(){return r&&r.isComplete()}}},P=function(t){if(!t.delay)return a(t);var n=t.delay;return delete t.delay,M(a,[t],n)},w=function(t){if(!t.delay)return u(t);var n=t.delay;return delete t.delay,M(u,[t],n)},L=function(t){var n=3;return t=t*n-n,0==t?1:(t*=Math.PI,Math.sin(t)/t)},S=function(t){var n=3;return t*=n,0==t?1:(t*=Math.PI,Math.sin(t)/t)},b=function(t){var n=3.5;return t=2*n*t-n,0==t?1:(t*=Math.PI,Math.sin(t)/t)},k=function(t){return t*t},A=function(t){return Math.sqrt(t)},I=function(t){return t},C=function(t){var n=.7;t=2*t-1;var e=t*t*t;return t=n*e+(1-n)*t,t=(t+1)/2},E=function(){var t=arguments;return function(n){console.log(n);for(var e=0;e<t.length;e++)n=t[e](n),console.log(n);return n}},O=function(t){return t&&Object(t)===t};n.exports={tween:P,loop:w,dom:c,queued:x,easings:{bounceOut:L,bounceIn:S,bounce:b,quadratic:k,linear:I,inverseQuadratic:A,fastSlowFast:C,combine:E}}},{commons:10,"commons/colors":9}],5:[function(t,n,e){var r=t("commons"),o=t("./animation"),i=function(t){var n=document.createElement(t);return c(n)},a=function(t){var n=document.createTextNode(t);return c(n)},u=function(t){var n=isString(t)?document.getElementById(t):t;return n?(n.fnode||(n.fnode=c(n)),n.fnode):null},c=function(t){if(t.fnode)return t.fnode;var n={attached:t==document.body,attachHandlers:[],detachHandlers:[],listeners:{}};t.fnode=n;var e=function(t){return function(n){var e=t(n);return void 0==e||e||(n.preventDefault(),n.stopPropagation()),e}},i=function(r,o,i){var a=e(o),u={listener:o,wrapper:a,useCapture:i};t.addEventListener(r,a,i),n.listeners[r]||(n.listeners[r]=[]),n.listeners[r].push(u)},a=function(e,o,i){if(e in n.listeners){var a=function(t){return t.listener==o&&t.useCapture==i},u=n.listeners[e],c=r.remove(u,a);t.removeEventListener(e,c.wrapper,c.useCapture),0==u.length&&delete n.listeners[e]}},f=function(){for(var e in n.listeners)r.forEach(n.listeners[e],function(n){t.removeEventListener(e,n.wrapper,n.useCapture)});n.listeners={}};return n.onAttached=function(e,r){if(void 0!=e)r?n.attachHandlers.unshift(e):n.attachHandlers.push(e);else if(!n.attached){var o;for(n.attached=!0,o=0;o<n.attachHandlers.length;o++)n.attachHandlers[o]();var i=t.childNodes;for(o=0;o<i.length;o++){var a=i[o];a.fnode&&a.fnode.onAttached()}}return n},n.onDetached=function(e,r){if(void 0!=e)r?n.detachHandlers.unshift(e):n.detachHandlers.push(e);else if(n.attached){n.attached=!1;var o;for(o=0;o<n.detachHandlers.length;o++)n.detachHandlers[o]();var i=t.childNodes;for(o=0;o<i.length;o++){var a=i[o];a.fnode&&a.fnode.onDetached()}}return n},n.raw=function(){return t},n.append=function(){for(var e=0;e<arguments.length;e++){var r=arguments[e];t.appendChild(r.raw()),n.attached&&r.onAttached()}return n},n.prepend=function(){for(var e=t.firstChild,r=0;r<arguments.length;r++){var o=arguments[r];t.insertBefore(o.raw(),e),n.attached&&o.onAttached()}return n},n.appendTo=function(e){return e.raw().appendChild(t),e.attached&&n.onAttached(),n},n.prependTo=function(e){var r=e.raw();return r.insertBefore(t,r.firstChild),e.attached&&n.onAttached(),n},n.insertBefore=function(){for(var e=arguments[0].raw(),r=1;r<arguments.length;r++){var o=arguments[r];t.insertBefore(o.raw(),e),n.attached&&o.onAttached()}return n},n.clear=function(){for(;t.lastChild;){var e=t.removeChild(t.lastChild);e.fnode&&e.fnode.onDetached()}return n},n.remove=function(){var e=t.parentNode;return e&&e.removeChild(t),n.onDetached(),n},n.parent=function(){var n=t.parentNode;return u(n)},n.children=function(){for(var n=[],e=t.childNodes,r=0;r<e.length;r++)n.push(c(e[r]));return n},n.on=function(t,e,o){return o=1==o,r.forEach(t.split(" "),function(t){i(t,e,o)}),n},n.off=function(){if(arguments.length>=2){var t=arguments[0],e=arguments[1],o=2 in arguments?1==arguments[2]:!1;r.forEach(t.split(" "),function(t){a(t,e,o)})}else f();return n},n.style=function(e,r){if(2==arguments.length)return t.style[e]=r,n;if(isString(e))return e in t.style&&!isCssNull(t.style[e])?t.style[e]:(n.styleCache||(n.styleCache=getComputedStyle(t,null)),n.styleCache[e]);for(var o in e)r=e[o],t.style[o]=r;return n},n.attr=function(){var e;if(2==arguments.length)return e=arguments[1],e?t.setAttribute(arguments[0],e):t.removeAttribute(arguments[0]),n;var r=arguments[0];if(isString(r))return t.getAttribute(r);for(var o in r)e=r[o],e?t.setAttribute(o,e):t.removeAttribute(o);return n},n.text=function(e){return 1==arguments.length?(t.textContent=e,n):t.textContent},n.html=function(e){return 1==arguments.length?(t.innerHTML=e,n):t.innerHTML},n.value=function(e){return 1==arguments.length?(t.value=e,n):t.value},n.prop=function(e,r){if(void 0!=r)return t[e]=r,n;if(isString(e))return t[e];for(var o in e)r=e[o],t[o]=r;return n},n.transform=function(e,r){var o=t.style.transform||t.style.msTransform||t.style.webkitTransform;return o=g(o),void 0!=r?(o[e]=r,o=d(o),t.style.transform=o,t.style.msTransform=o,t.style.webkitTransform=o,n):o[e]},n.blur=function(){return t.blur(),n},n.focus=function(){return t.focus(),n},n.animate=function(t,e){return o.dom(n,t,e)},n.box=function(n){var e=t.getBoundingClientRect(),r={top:e.top,left:e.left,width:e.width,height:e.height,right:e.right,bottom:e.bottom};if(n){var o=document.body,i=document.documentElement,a=window.pageYOffset||i.scrollTop||o.scrollTop,u=window.pageXOffset||i.scrollLeft||o.scrollLeft,c=i.clientTop||o.clientTop||0,f=i.clientLeft||o.clientLeft||0,s=a-c,l=u-f;r.top+=s,r.left+=l,r.right+=l,r.bottom+=s}return r},n.width=function(){if(0==arguments.length)return n.box().width;var t=arguments[0];return(!isString(t)||t.search(/[^.0-9]/)<=0)&&(t+="px"),n.style("width",t),n},n.height=function(){if(0==arguments.length)return n.box().height;var t=arguments[0];return(!isString(t)||t.search(/[^.0-9]/)<=0)&&(t+="px"),n.style("height",t),n},n.child=function(n){return c(t.childNodes[n])},n.maximize=function(){return n.shouldBeMaximized=!0,n},n.clone=function(){return c(t.cloneNode(!0))},n},f=function(t){s(document.readyState)&&document.body?t():document.addEventListener("DOMContentLoaded",t,!1)},s=function(t){return"complete"==t||"loaded"==t||"interactive"==t},l=function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);var e={};return e.forEach=function(n){for(var e=0;e<t.length;e++)n(t[e],e)},e.size=function(){return t.length},e.animate=function(t,n){n=n||{};var o=r.clone(n);delete n.onDone,delete n.onComplete,delete n.onCanceled,delete n.onTick;var i=n.stagger||0,a=n.delay||0,u=e.size()-1;e.forEach(function(e,c){var f;f=u>c?r.clone(n):o,f.delay=a,a+=i,e.animate.call(e,t,f)})},e},g=function(t){var n={};if(!t||0==t.length)return n;for(var e=t.split(" "),r=0;r<e.length;r++){var o=e[r],i=o.indexOf("("),a=i>0?o.substr(0,i):o;n[a]=i>0?o.substr(i+1,o.length-i-2):null}return n},d=function(t){var n="";for(var e in t){var r=t[e];n+=e+(isDefined(r)?"("+r+")":"")+" "}return n.length>0?n.substr(0,n.length-1):n},h={text:a,node:i,wrap:c,getNode:u,group:l,onReady:f};f(function(){h.body=c(document.body),h.document=c(document),h.window=c(window)}),n.exports=h},{"./animation":4,commons:10}],6:[function(t,n,e){var r=t("client/ajax"),o={},i=[],a=!1,u=function(t){return a?setTimeout(t,0):void i.push(t)},c=function(){a=!0,i.forEach(function(t){t()})},f=function(t){isArray(t)||(t=s(arguments));for(var n=o,e=0;e<t.length;e++){var r=t[e];if(!(isObject(n)&&r in n))return t.join(".");n=n[r]}return isString(n)?n:t.join(".")},s=function(t){for(var n=[],e=0;e<t.length;e++)n.push(t[e]);return n},l=function(){var t={modified:0};r.post("/api/i18n").attach(t).onSuccess(function(n){n=JSON.parse(n),n.labels?(o=n.labels,localStorage.setItem("labels",JSON.stringify(n))):o=t.labels,c()}).onFailure(function(t){console.error(t),c()}).send()},g=function(){d&&localStorage.removeItem("labels")},d=function(){if(!localStorage)return!1;try{var t="32874_dummy",n="a value";localStorage.setItem(t,n);var e=localStorage.getItem(t);return e!=n?!1:(localStorage.removeItem(t),!0)}catch(r){return!1}}();n.exports={get:f,onReady:u,clear:g,initialize:l}},{"client/ajax":3}],7:[function(t,n,e){n.exports={error:function(t){return t?console.error(t):void 0},info:function(t){return t?console.log(t):void 0},warn:function(t){return t?console.warn(t):void 0}}},{}],8:[function(t,n,e){var r=t("./animation"),o=t("./fiat"),i={DOWN:"DOWN",UP:"UP",MOVE:"MOVE",CANCEL:"CANCEL"},a={INITIAL:"INITIAL",TAPPING:"TAPPING",MOVING:"MOVING",PRESSING:"PRESSING"},u=function(){},c=cmToPx(.5),f=function(t){return t.xpms=Math.max(-c,Math.min(c,t.xpms)),t.ypms=Math.max(-c,Math.min(c,t.ypms)),t},s=function(t){return t=t||{},t.onUp=t.onUp||u,t.onDown=t.onDown||u,t.onTap=t.onTap||u,t.onLongPress=t.onLongPress||u,t.onPan=t.onPan||u,t.onPinch=t.onPinch||u,t.onSwipe=t.onSwipe||u,t},l=function(t){return t=t||{},t.longPressTimeout=t.longPressTimeout||400,t.tapUpTimeout=t.tapUpTimeout||200,t.tapDownTimeout=t.tapDownTimeout||200,t.pixelsTillMove=t.pixelsTillMove||5,t.proximity=t.proximity||20,t.minSwipeVelocity=t.minSwipeVelocity||30,t.predicate=t.predicate||S,t},g=function(t,n){var e=t.x-n.x,r=t.y-n.y;return Math.sqrt(e*e+r*r)},d=function(t){null!=t&&window.clearInterval(t)},h=function(t,n,e,r){t.xpms=(1-r)*t.xpms+r*n,t.ypms=(1-r)*t.ypms+r*e},v=function(t,n,e){var r={id:t},o=null,u=null,c=null,s=null,l=null,g=null,v=null,p=null,m=null,y=0,T=null,x=null;r.onEvent=function(t,n,e){I(n,e),M(t)||(G(),P(t))};var M=function(t){return t==i.MOVE&&(c==s||o==a.INITIAL&&D(u)<e.pixelsTillMove)},P=function(t){switch(t){case i.UP:n.onUp(c),L();break;case i.DOWN:n.onDown(c),w();break;case i.MOVE:B(),S();break;case i.CANCEL:E()}},w=function(){switch(o){case a.INITIAL:y=1,v=window.setInterval(b,e.longPressTimeout);break;case a.TAPPING:D(s)<e.proximity?(y++,m=window.setInterval(k,e.tapDownTimeout)):(n.onTap(u,y),N(a.INITIAL),w())}},L=function(){switch(o){case a.INITIAL:o=a.TAPPING;case a.TAPPING:p=window.setInterval(A,e.tapUpTimeout);break;case a.MOVING:X()&&n.onSwipe(u,f(T));case a.PRESSING:E()}},S=function(){switch(o){case a.INITIAL:o=a.MOVING;case a.MOVING:n.onPan(u,s,c)}},b=function(){G(),o=a.PRESSING,n.onLongPress(u),N(a.MOVING)},k=function(){G(),n.onTap(u,y),N(a.MOVING)},A=function(){G(),n.onTap(u,y),E()},I=function(t,n){null===o?C(t,n):O(t,n)},C=function(t,n){u=t,o=a.INITIAL,c=u,s=u,l=n,g=n,T={xpms:0,ypms:0}},E=function(t){o=null,u=null,c=null,s=null,l=null,g=null,y=0,T=null,!t&&x&&x(r)},O=function(t,n){g=l,s=c,c=t,l=n},N=function(t){var n=c,e=l;E(!0),C(n,e),o=t},G=function(){d(m),d(v),d(p)},B=function(){var t=l-g;if(t>0){var n=c.x-s.x,e=c.y-s.y,r=n/t,o=e/t;h(T,r,o,.3)}},X=function(){var t=l-g;return 100>=t},Y=function(t){return{x:c.x-t.x,y:c.y-t.y}},D=function(t){var n=Y(t);return Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2))};return r.getLastLocation=function(){return s},r.getLocation=function(){return c},r},p=function(t,n){var e={};e.onUp=function(n){r()&&t.onUp(n)},e.onDown=function(n){r()&&t.onDown(n)},e.onTap=function(n,e){r()&&t.onTap(n,e)},e.onLongPress=function(n){r()&&t.onLongPress(n)},e.onPan=function(n,e,a){if(r())t.onPan(n,e,a);else{var u=o(n);i(u.a,u.b)}},t.onWheel&&(e.onWheel=t.onWheel),t.onHover&&(e.onHover=t.onHover),e.onSwipe=t.onSwipe;var r=function(){return 1==n.length},o=function(t){var e={};for(var r in n.ids){var o=n.ids[r];o.origin!=t?e.a=o:e.b=o}return e},i=function(n,e){var r={x:(n.origin.x+e.origin.x)/2,y:(n.origin.y+e.origin.y)/2},o=g(n.getLastLocation(),e.getLastLocation()),i=g(n.getLocation(),e.getLocation());if(o>0){var a=i/o;t.onPinch(r,a)}};return e},m=function(t,n){var e={},r={length:0,ids:{}};t=p(t,r),e.onUp=function(t,n,e){var r=o(t);r.onEvent(i.UP,n,e)},e.onDown=function(t,n,e){var r=o(t);r.onEvent(i.DOWN,n,e)},e.onMove=function(t,n,e){var r=o(t);return r.onEvent(i.MOVE,n,e)},e.onCancel=function(t,n,e){var r=o(t);r.onEvent(i.CANCEL,n,e)},t.onWheel&&(e.onWheel=function(n,e){return t.onWheel(n,e)}),t.onHover&&(e.onHover=function(n){return t.onHover(n)});var o=function(e){if(e in r.ids)return r.ids[e];var o=v(e,t,n);return o.onStop=function(t){delete r.ids[t.id],r.length--},r.ids[e]=o,r.length++,o};return e},y=function(t,n,e){var r=P(n,e);r("touchstart",function(n,e,r){return t.onDown(n,e,r),!1}),r("touchend",function(n,e,r){return t.onUp(n,e,r),!1}),r("touchmove",function(n,e,r){return t.onMove(n,e,r),!1}),r("touchcancel",function(n,e,r){t.onCancel(n,e,r)})},T=function(t,n,e){var r=M(n,e),o=!1;r("mousedown",function(n,e,r){return o=!0,t.onDown(0,e,r),!1}),r("mouseup mouseleave",function(n,e,r){return o?(o=!1,t.onUp(0,e,r),!1):void 0}),r("mousemove",function(n,e,r){return o?(t.onMove(0,e,r),!1):t.onHover?t.onHover(e,n):void 0}),n.on("click",function(){return!1}),t.onWheel&&x(t,r)},x=function(t,n){var e=null,o=function(){e=null};n("mousewheel DOMMouseScroll MozMousePixelScroll",function(n,i){if(n.detail&&0!=n.detail||n.wheelDelta&&0!=n.wheelDelta){var a=n.detail<0||n.wheelDelta>0?1:-1;return e&&e.delta==a||(e&&e.cancel(),e=r.tween({from:0,to:1,duration:200,onTick:function(){t.onWheel(i,a)},onComplete:o}),e.delta=a),!1}})},M=function(t,n){return function(e,r){t.on(e,function(e){if(n(e)){var o=w(e,t),i=e.timeStamp;return r(e,o,i)}},!1)}},P=function(t,n){return function(e,r){t.on(e,function(e){for(var o=e.changedTouches,i=!0,a=0;a<o.length;a++){var u=o[a];if(n(u)){var c=u.identifier,f=w(u,t),s=e.timeStamp;i=i&&r(c,f,s)}}return i},!1)}},w=function(t,n){var e=n.box();return{x:t.clientX-e.left,y:t.clientY-e.top}},L=function(t,n,e){n=s(n),e=l(e);var r=m(n,e);y(r,t,e.predicate),T(r,t,e.predicate)},S=function(t){var n=document.activeElement;if(n&&!k(o.getNode(n)))return!1;var e=o.getNode(t.target||t.srcElement);return k(e)},b="pointPad",k=function(t){for(var n=t;null!=n;){if(b in n){var e=n[b];return t[b]=e,e}n=n.parent()}return!0};n.exports={listen:L,defaultPredicate:S}},{"./animation":4,"./fiat":5}],9:[function(t,n,e){var r=t("./commons"),o=function(t){var n,e,r=t.r/255,o=t.g/255,i=t.b/255,a=Math.max(r,o,i),u=Math.min(r,o,i),c=(a+u)/2;if(a==u)n=e=0;else{var f=a-u;switch(e=c>.5?f/(2-a-u):f/(a+u),a){case r:n=(o-i)/f+(i>o?6:0);break;case o:n=(i-r)/f+2;break;case i:n=(r-o)/f+4}n/=6}return{h:n,s:e,l:c}},i=function(t,n,e){return 0>e&&(e+=1),e>1&&(e-=1),1/6>e?t+6*(n-t)*e:.5>e?n:2/3>e?t+(n-t)*(2/3-e)*6:t},a=function(t){var n,e,r,o=t.h,a=t.s,u=t.l;if(0==a)n=e=r=u;else{var c=.5>u?u*(1+a):u+a-u*a,f=2*u-c;n=i(f,c,o+1/3),e=i(f,c,o),r=i(f,c,o-1/3)}return d(Math.floor(255*n),Math.floor(255*e),Math.floor(255*r))},u=function(t){return"#"+l(t.r)+l(t.g)+l(t.b)},c=function(t){var n=t.r;return n=n<<8|t.g,n=n<<8|t.b},f=function(t){var n=255,e=t>>16&n,r=t<<8&n,o=t&n;return d(e,r,o)},s=function(){var t=Math.floor(256*Math.random()),n=Math.floor(256*Math.random()),e=Math.floor(256*Math.random());return d(t,n,e)},l=function(t){var n=Math.round(t).toString(16);return n.length<2&&(n="0"+n),n},g=function(t){"#"==t[0]&&(t=t.substr(1));var n=parseInt(t.substr(0,2),16),e=parseInt(t.substr(2,2),16),r=parseInt(t.substr(4,2),16);return d(n,e,r)},d=function(t,n,e,r){r=void 0==r?1:r;var o={r:t||0,g:n||0,b:e||0,a:r,toString:function(){return"rgba("+o.r+", "+o.g+", "+o.b+", "+o.a+")"}};return o},h=function(t,n){var e=g(t),r=o(e);return r.l*=n,r.l=Math.max(0,Math.min(r.l,1)),e=a(r),u(e)},v=function(t){if(t&&0!=t.length){if("#"==t[0])return g(t);if(r.startsWith(t,"rgb")){var n=p(t);return d.apply(this,n)}}},p=function(t){return t.replace(/[^0-9\-\+eE\.]/g," ").split(" ").filter(function(t){return t}).map(function(t){return parseFloat(t)})};n.exports={rgb:d,rgbToInt:c,rgbToHex:u,rgbToHsl:o,hslToRgb:a,random:s,lighten:h,intToRgb:f,hexToRgb:g,parseRgb:v,darker:"#030303",dark:"#303030",bright:"#f3f3f3",signal:"#ffaa55"}},{"./commons":10}],10:[function(t,n,e){(function(t){var e=Array.isArray||function(t){return t instanceof Array},r=r||function(t){return"object"==typeof t&&null!==t},o=function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);var e={};return e.push=function(n){return t.push(n),e},e.pop=function(){return t.pop()},e.peek=function(){var n=t.length;return n?t[n-1]:void 0},e.size=function(){return t.length},e.get=function(n){return t[n]},e.isEmpty=function(){return!t.length},e},i=function(t,n){for(var e=0;e<t.length;e++)if(n(t[e]))return e;return-1},a=function(t,n){for(var e=0;e<t.length;e++){var r=t[e];if(r==n)return e}return-1},u=function(t,n){for(var e=0;e<t.length;e++)if(p(n,t[e]))return e;return-1},c=function(t,n){var e=i(t,n);return e>=0?t[e]:void 0},f=function(t,n){var e=i(t,n);if(e>=0){var r=t[e];return t.splice(e,1),r}},s=function(t,n){for(var e=0;e<t.length;e++)if(t[e]===n)return t.splice(e,1),!0;return!1},l=function(t,n){for(var e=0;e<t.length;e++)if(p(n,t[e]))return t.splice(e,1),!0;return!1},g=function(t,n){return a(t,n)>=0},d=function(t){var n={};n.weigh=function(){return 1},n.onDismiss=function(){};var e=0,r=h(),o={};n.get=function(t){if(t in o){var n=o[t];return r.removeNode(n),r.addNode(n),n.element.value}},n.getSilently=function(t){if(t in o){var n=o[t];return n.element.value}},n.put=function(t,i,u){var c={key:t,value:i},f=r.add(c);return t in o&&a(t),o[t]=f,e+=n.weigh(t,i),u&&n.shrink(),f},n.shrink=function(){for(;e>t;){var n=r.nodeFromTail(i);if(null==n)break;u(n)}};var i=function(t){var n=t.element;return!n.pinned};n.forEach=r.forEach;var a=function(t){var n=o[t];u(n)},u=function(t){r.removeNode(t);var i=t.element.key,a=t.element.value;e-=n.weigh(i,a),delete o[i],n.onDismiss(i,a)};return n},h=function(){var t={},n=null,e=null;t.add=function(n){var e={previous:null,next:null,element:n};return t.addNode(e),e},t.remove=function(n){var e=r(n);null!=e&&t.removeNode(e)},t.forEach=function(t){for(var e=n;null!=e;)t(e.element),e=e.next},t.nodeFromTail=function(t){for(var n=e;null!=n;){if(t(n))return n;n=n.previous}return null},t.nodeFromHead=function(t){for(var e=n;null!=e;){if(t(e))return e;e=e.next}return null};var r=function(t){for(var e=n;null!=e&&e.element!=t;)e=e.next;return e};return t.addNode=function(t){null===n?(n=t,e=t):(t.next=n,n.previous=t,n=t)},t.removeNode=function(t){var r=t.previous,o=t.next;null!=r&&(r.next=o),null!=o&&(o.previous=r),n==t&&(n=o),e==t&&(e=t.previous)},t.print=function(){for(var t=n,e="";null!=t;)e+=";",e+=t.element,t=t.next;return e},t},v=function(){var t={};return{put:function(n,e){var r=t[n];r||(r=[],t[n]=r),r.push(e)},forEach:function(n,e){if(2==arguments.length){var r=t[n];return r&&r.forEach(e)}for(n in t)t[n].forEach(e)},remove:function(n,e){var r=t[n];return e?(s(r,e),void(r.length||delete t[n])):(delete t[n],r||[])}}},p=function(t,n){if(t===n)return!0;if(e(t)){if(!e(n)||n.length!=t.length)return!1;for(var o=0;o<t.length;o++)if(!p(t[o],n[o]))return!1;return!0}if(t instanceof Date)return!n instanceof Date?!1:t.getTime()==n.getTime();if(r(t)){if(!r(n))return!1;for(var i in t)if(!(i in n&&p(t[i],n[i])))return!1;return!0}return t==n},m=function(t){var n,o;if(e(t)){n=[];for(var i=0;i<t.length;i++)o=m(t[i]),n.push(o);return n}if(r(t)){if("clone"in t)return t.clone();n={};for(var a in t)o=m(t[a]),n[a]=o;return n}return t},y=function(t,n){return t.length>=n.length&&t.substr(0,n.length)===n},T=function(t,n){if(t){var e=t.length;if(e)for(var r=0;e>r;r++){var o=t[r];n(o,r)}}},x=function(t){return t^=t>>>16,t*=2246822507,t^=t>>>13,t*=3266489909,t^=t>>>16},M=function(t,n){for(var e in t)e in n||(n[e]=t[e]);return n},P=function(t,n){var e=Math.min(t.length,n||10);t=t.toLowerCase();for(var r="",o=0;e>o;o++){var i=t.charCodeAt(o);r+=i>=97&&122>=i||i>=48&&57>=i?t[o]:"_"}return r},w=function(){var n=t.split("/");return n.pop(),n.pop(),n.join("/")+"/"},L="abcdefghijklmnopqrstuvwxyz0123456789",S=function(t){for(var n="",e=0;t>e;e++){var r=Math.floor(Math.random()*L.length);n+=L[r]}return n},b=function(t){t()},k=function(t){t.forEach(b)},A=function(){var t,n,e,r,o,i,a,u=function(){return e&&(a=a||setTimeout(function(){a=null,r?i&&i(n):o&&o(t)},0)),c},c={set:function(n){t=n,e=!0,r=!1,u()},fail:function(t){n=t,e=!0,r=!0,u()},onDone:function(t){return o=t,u()},onFailed:function(t){return i=t,u()}};return c},I=function(t){var n=!1,e=!1,r=function(){n=!1,e&&(e=!1,o())},o=function(){return n?e=!0:(n=!0,void t(r))};return o};n.exports={future:A,contains:g,forEach:T,clone:m,getElement:c,indexOf:i,indexOfElement:a,indexOfEqual:u,remove:f,removeElement:s,removeEqual:l,equals:p,murmurHash:x,startsWith:y,LruCache:d,LinkedList:h,MultiMap:v,Stack:o,extend:M,toHarmlessString:P,getRootFolder:w,randomId:S,runAll:k,delayedCode:I}}).call(this,"/node_modules/commons")},{}],11:[function(t,n,e){var r=t("./geometry"),o=function(){},i=i||function(t){return Math.round(50*t)};n.exports=function(t,n){n=n||{};var e=2*Math.PI,a=Math.round(i(n.strong||20)/100),u=Math.round(i(n.light||5)/100),c=Math.round(i(n.dotSize||20)/100),f=n.dark||"#303030",s=n.bright||"#f3f3f3",l=n.alpha||.6;!function(){t.lineJoin="round",t.mozFillRule="evenodd",t.setLineDash=t.setLineDash||o,t.getLineDash=t.getLineDash||o,t.font="12pt Calibri",t.textAlign="center",t.textBaseline="middle"}();var g=function(t){d(t.getX(),t.getY())},d=function(n,r){var o=t.fillStyle;t.beginPath(),t.arc(n,r,c,0,e,!1),t.fillStyle=s,t.fill(),t.lineWidth=u,t.strokeStyle=f,t.stroke(),t.beginPath(),t.arc(n,r,.5*c,0,e,!1),t.fillStyle=f,t.fill(),t.fillStyle=o},h=function(n){var r=n.getCenter(),o=n.getRadius();t.beginPath(),t.arc(r.getX(),r.getY(),o,0,e,!1),T(l,f),t.lineWidth=a,t.strokeStyle=f,t.stroke(),g(r)},v=function(n,e){t.beginPath(),t.rect(n.getLeft(),n.getTop(),n.getWidth(),n.getHeight()),T(l,f),t.lineWidth=a,t.strokeStyle=f,t.stroke(),e&&d(n.getLeft(),n.getTop())},p=function(n){var e=n.getStart(),r=n.getStop();t.beginPath(),t.moveTo(e.getX(),e.getY()),t.lineTo(r.getX(),r.getY()),t.lineWidth=a,t.strokeStyle=f,t.stroke(),g(e),g(r)},m=function(n,e,r){var o=n.isClosed(),i=n.getLines();if(0!=i.length){var u=i[0].getStart();t.beginPath(),t.moveTo(u.getX(),u.getY());var c,s;for(c=0;c<i.length;c++)s=i[c].getStop(),t.lineTo(s.getX(),s.getY());if(o&&!e){var d=i[0].getStop();t.lineTo(d.getX(),d.getY())}if(r&&T(l,f),t.lineWidth=a,t.strokeStyle=f,t.stroke(),o||g(u),e)for(c=0;c<i.length;c++)s=i[c].getStop(),g(s);else if(!o){var h=i[i.length-1].getStop();g(h)}}},y=function(t,n){for(var e=t.getPaths(),r=0;r<e.length;r++)m(e[r],n,!0)},T=function(n,e){if(n>=1)t.fillStyle=e,t.fill("evenodd");else{var r=t.globalAlpha;t.globalAlpha=r*n,t.fillStyle=e,t.fill("evenodd"),t.globalAlpha=r}};return{fillWithAlpha:T,setColor:function(t,n){return n?s=t:void(f=t)},setAlpha:function(t){l=t},draw:function(t,n){switch(t.getType()){case r.Type.POINT:g(t);break;case r.Type.CIRCLE:h(t,n);break;case r.Type.BOX:v(t,n);break;case r.Type.LINE:p(t);break;case r.Type.PATH:m(t,n);break;case r.Type.POLYGON:y(t,n)}}}}},{"./geometry":12}],12:[function(t,n,e){var r=function(t,n,e,r){var o=t-e,i=n-r;return Math.sqrt(o*o+i*i)},o=function(t,n,e,r){return t*r-n*e},i=function(t,n,e,r,i,u,c,f){var s,l,g=e-t,d=r-n,h=c-i,v=f-u,p=t-i,T=n-u,x=o(g,d,h,v),M=o(p,T,h,v),P=o(p,T,g,d),w=Math.abs(x)>Math.abs(M),L=Math.abs(x)>Math.abs(P);if(w&&L){s=M/x;var S=t+s*g,b=n+s*d;return m(S,b,S,b,0)}return w?(l=P/x,l>0?a(c,f,t,n,e,r):a(i,u,t,n,e,r)):L?(s=M/x,s>0?a(e,r,i,u,c,f):a(t,n,i,u,c,f)):(l=P/x,s=M/x,y(l>0?a(c,f,t,n,e,r):a(i,u,t,n,e,r),s>0?a(e,r,i,u,c,f):a(t,n,i,u,c,f)))},a=function(t,n,e,r,o,i){var a=o-e,u=i-r;if(0==a&&0==u)return m(t,n,e,r);var c=((t-e)*a+(n-r)*u)/(a*a+u*u);if(0>=c)return m(t,n,e,r);if(c>=1)return m(t,n,o,i);var f=e+c*a,s=r+c*u;return m(t,n,f,s)},u=function(t,n,e){return n>t!=e>t},c=function(t,n,e,r){return Math.max(t,e)<=Math.min(n,r)},f={POINT:"POINT",LINE:"LINE",BOX:"BOX",CIRCLE:"CIRCLE",PATH:"PATH",POLYGON:"POLYGON"},s=function(){var t={mark:null};return t.markAs=function(n){return t.mark=n,t},t.isMarkedAs=function(n){return t.mark===n},t},l={create:function(t,n){var e=s(),r=[];return e.getX=function(){return t},e.getY=function(){return n},e.equals=function(e){return t==e.getX()&&n==e.getY()},e.setMin=function(e,r){t=Math.min(t,e),n=Math.min(n,r)},e.setMax=function(e,r){t=Math.max(t,e),n=Math.max(n,r)},e.set=function(r,o){return t=r,n=o,e},e.clipX=function(n,r){return t=Math.min(Math.max(t,n),r),e},e.clipY=function(t,r){
return n=Math.min(Math.max(n,t),r),e},e.backup=function(){return r.push(t),r.push(n),e},e.restore=function(){return n=r.pop(),t=r.pop(),e},e.translate=function(r,o){return t+=r,n+=o,e},e.translateAndMark=function(t,n,r){return e.isMarkedAs(r)||(e.markAs(r),e.translate(t,n)),e},e.scale=function(r,o){return t*=r,n*=o,e},e.scaleAndMark=function(t,n,r){return e.isMarkedAs(r)||(e.markAs(r),e.scale(t,n)),e},e.transform=function(t){return t.transformPoint(e),e},e.transformAndMark=function(t,n){return e.isMarkedAs(n)||(e.markAs(n),t.transformPoint(e)),e},e.getType=function(){return f.POINT},e.toJson=function(){return[t,n]},e.toGeoJson=function(){return{type:"Point",coordinates:e.toJson()}},e.copy=function(){return l.create(t,n)},e.toString=function(){return"("+t+"/"+n+")"},e.distanceTo=function(e,r){return m(t,n,e,r)},e.distanceToPoint=function(e){return m(t,n,e.getX(),e.getY())},e.containsPoint=function(e){return t==e.getX()&&n==e.getY()},e.computeBoundingBox=function(t){return t.set(e,e)},e},fromJson:function(t){var n=t[0],e=t[1];return l.create(n,e)},fromGeoJson:function(t){var n=t.coordinates;return l.fromJson(n)}},g={create:function(t,n){var e=s(),o=[];return e.getCenter=function(){return t},e.getRadius=function(){return n},e.setRadius=function(t){return n=t,e},e.scale=function(r,o){return t.scale(r,o),n*=Math.max(r,o),e},e.scaleAndMark=function(r,o,i){return e.isMarkedAs(i)||(e.markAs(i),t.scaleAndMark(r,o,i),n*=Math.max(r,o)),e},e.translate=function(n,r){return t.translate(n,r),e},e.translateAndMark=function(n,r,o){return e.isMarkedAs(o)||(e.markAs(o),t.translateAndMark(n,r,o)),e},e.transform=function(r){return r.transformPoint(t),n=r.transformDistance(n),e},e.transformAndMark=function(r,o){return e.isMarkedAs(o)||(e.markAs(o),t.transformAndMark(r,o),n=r.transformDistance(n)),e},e.backup=function(){return t.backup(),o.push(n),e},e.restore=function(){return t.restore(),n=o.pop(),e},e.getType=function(){return f.CIRCLE},e.toJson=function(){return[t.toJson(),n]},e.toGeoJson=function(){return{type:"Circle",coordinates:t.toJson(),radius:n}},e.copy=function(){return g.create(t.copy(),n)},e.distanceTo=function(e,o,i){var a=t.getX(),u=t.getY(),c=e-a,f=o-u;void 0===i&&(i=r(a,u,e,o));var s=n/i;return m(e,o,a+s*c,u+s*f,i-n)},e.distanceToPoint=function(t){var n=t.getX(),r=t.getY();return e.distanceTo(n,r)},e.distanceToGeometry=function(n){var r=n.distanceToPoint(t);return e.distanceTo(r.otherX(t.getX()),r.otherY(t.getY()),r.pixels)},e.contains=function(e,o){var i=r(t.getX(),t.getY(),e,o);return n>=i},e.containsPoint=function(t){return e.contains(t.getX(),t.getY())},e.intersectsGeometry=function(e){var r=e.distanceToPoint(t);return r.pixels<=n},e.computeBoundingBox=function(e){var r=2*n;return e.setBox(t.getX()-n,t.getY()-n,r,r)},e},fromJson:function(t){var n=l.fromJson(t[0]),e=t[1];return g.create(n,e)},fromGeoJson:function(t){var n=t.radius,e=l.fromJson(t.coordinates);return g.create(e,n)}},d={create:function(t,n){var e=s();n=n||t.copy(),n==t&&(n=n.copy()),e.getLeft=t.getX,e.getTop=t.getY,e.getRight=n.getX,e.getBottom=n.getY;var r=function(){var e=t.getX(),r=n.getX(),o=t.getY(),i=n.getY();t.setMin(r,i),n.setMax(e,o)};r(),e.toString=function(){return"[ "+t.toString()+" / "+n.toString()+" ]"},e.getTopLeft=function(){return t},e.getBottomRight=function(){return n},e.getWidth=function(){return e.getRight()-e.getLeft()},e.getHeight=function(){return e.getBottom()-e.getTop()},e.set=function(r,o){return t.set(r.getX(),r.getY()),n.set(o.getX(),o.getY()),e},e.stretchToContain=function(r){var o=r.getX(),i=r.getY();return t.setMin(o,i),n.setMax(o,i),e},e.setBox=function(r,o,i,a){return t.set(r,o),n.set(r+i,o+a),e},e.translate=function(r,o){return t.translate(r,o),n.translate(r,o),e},e.translateAndMark=function(r,o,i){return e.isMarkedAs(i)||(e.markAs(i),t.translateAndMark(r,o,i),n.translateAndMark(r,o,i)),e},e.scale=function(r,o){return t.scale(r,o),n.scale(r,o),e},e.scaleAndMark=function(r,o,i){return e.isMarkedAs(i)||(e.markAs(i),t.scaleAndMark(r,o,i),n.scaleAndMark(r,o,i)),e},e.transform=function(o){return t.transform(o),n.transform(o),r(),e},e.transformAndMark=function(o,i){return e.isMarkedAs(i)||(e.markAs(i),t.transformAndMark(o,i),n.transformAndMark(o,i),r()),e},e.backup=function(){return t.backup(),n.backup(),e},e.restore=function(){return t.restore(),n.restore(),e},e.getType=function(){return f.BOX},e.toJson=function(){return[t.toJson(),n.toJson()]},e.toGeoJson=function(){return{type:"Envelope",coordinates:e.toJson()}},e.copy=function(){return d.create(t.copy(),n.copy())};var o=function(t){return t<e.getTop()?0:t<e.getBottom()?1:2},i=function(t){return t<e.getLeft()?0:t<e.getRight()?1:2};e.getSector=function(t,n){var e=i(t),r=o(n);return 3*r+e},e.getPointsSector=function(t){return e.getSector(t.getX(),t.getY())},e.distanceTo=function(t,n){var r=e.getSector(t,n);switch(r){case 0:return m(t,n,e.getLeft(),e.getTop());case 1:return m(t,n,t,e.getTop(),e.getTop()-n);case 2:return m(t,n,e.getRight(),e.getTop());case 3:return m(t,n,e.getLeft(),n,e.getLeft()-t);case 4:return a(t,n);case 5:return m(t,n,e.getRight(),n,t-e.getRight());case 6:return m(t,n,e.getLeft(),e.getBottom());case 7:return m(t,n,t,e.getBottom(),n-e.getBottom());case 8:return m(t,n,e.getRight(),e.getBottom())}};var a=function(t,n){var r=e.getLeft(),o=e.getTop(),i=e.getRight(),a=e.getBottom(),u=r+(i-r)/2,c=o+(a-o)/2;return u>t?c>n?y(m(t,n,t,o),m(t,n,r,n)):y(m(t,n,t,a),m(t,n,r,n)):c>n?y(m(t,n,t,o),m(t,n,i,n)):y(m(t,n,t,a),m(t,n,i,n))};return e.distanceToPoint=function(t){return e.distanceTo(t.getX(),t.getY())},e.contains=function(t,n){return 4==e.getSector(t,n)},e.containsPoint=function(t){return e.contains(t.getX(),t.getY())},e.intersectsBox=function(t){return c(e.getLeft(),e.getRight(),t.getLeft(),t.getRight())&&c(e.getTop(),e.getBottom(),t.getTop(),t.getBottom())},e.computeBoundingBox=function(e){return e.set(t,n)},e},empty:function(){var t=l.create(0,0);return d.create(t.copy(),t.copy())},fromJson:function(t){var n=l.fromJson(t[0]),e=l.fromJson(t[1]);return d.create(n,e)},fromGeoJson:function(t){return d.fromJson(t.coordinates)}},h={create:function(t,n){var e=s();e.getStart=function(){return t},e.getStop=function(){return n},e.translate=function(r,o){return t.translate(r,o),n.translate(r,o),e},e.translateAndMark=function(r,o,i){return t.translateAndMark(r,o,i),n.translateAndMark(r,o,i),e},e.scale=function(r,o){return t.scale(r,o),n.scale(r,o),e},e.scaleAndMark=function(r,o,i){return t.scaleAndMark(r,o,i),n.scaleAndMark(r,o,i),e},e.transform=function(r){return t.transform(r),n.transform(r),e},e.transformAndMark=function(r,o){return t.transformAndMark(r,o),n.transformAndMark(r,o),e},e.backup=function(){return t.backup(),n.backup(),e},e.restore=function(){return t.restore(),n.restore(),e},e.getType=function(){return f.LINE},e.toJson=function(){return[t.toJson(),n.toJson()]},e.toGeoJson=function(){return{type:"MultiPoint",coordinates:e.toJson()}},e.copy=function(){return h.create(t.copy(),n.copy())},e.distanceTo=function(e,r){return a(e,r,t.getX(),t.getY(),n.getX(),n.getY())},e.distanceToPoint=function(t){return e.distanceTo(t.getX(),t.getY())},e.distanceToLine=function(e){var r=e.getStart(),o=e.getStop();return i(t.getX(),t.getY(),n.getX(),n.getY(),r.getX(),r.getY(),o.getX(),o.getY())},e.distanceToBox=function(e){var r=e.getLeft(),o=e.getTop(),a=e.getRight(),u=e.getBottom(),c=t.getX(),f=t.getY(),s=n.getX(),l=n.getY();return T(i(c,f,s,l,r,o,a,o),i(c,f,s,l,a,o,a,u),i(c,f,s,l,a,u,r,u),i(c,f,s,l,r,u,r,o))},e.intersects=function(e,r){var o=t.getX(),i=n.getX();if(!u(e,o,i))return!1;var a=t.getY(),c=n.getY();if(!u(r,a,c))return!1;var f=i-o,s=c-a;return f/s==(e-o)/(r-a)},e.intersectsPoint=function(t){return e.intersects(t.getX(),t.getY())},e.intersectsLine=function(r){var o=r.getStart(),i=r.getStop();return r.doesSeparate(t.getX(),t.getY(),n.getX(),n.getY())&&e.doesSeparate(o.getX(),o.getY(),i.getX(),i.getY())};var r=function(r,o,i){return u(r,t.getY(),n.getY())&&e.doesSeparate(o,r,i,r)},o=function(r,o,i){return u(r,t.getX(),n.getX())&&e.doesSeparate(r,o,r,i)};return e.doesSeparate=function(e,r,o,i){var a=t.getX(),u=t.getY(),c=n.getX(),f=n.getY(),s=a-c,l=f-u,g=(e-a)*l+(r-u)*s,d=(o-a)*l+(i-u)*s;return 0>g!=0>d},e.intersectsBox=function(e){var i=e.getPointsSector(t),a=e.getPointsSector(n);if(4==i||4==a)return!0;if(i==a)return!1;var u=e.getLeft(),c=e.getRight(),f=e.getTop(),s=e.getBottom();return r(f,u,c)||r(s,u,c)||o(u,f,s)||o(c,f,s)},e.computeBoundingBox=function(e){return e.set(t,t),e.stretchToContain(n),e},e},fromJson:function(t){var n=l.fromJson(t[0]),e=l.fromJson(t[1]);return h.create(n,e)},fromGeoJson:function(t){return h.fromJson(t.coordinates)}},v={create:function(){var t=s(),n=null,e=[],r=!0;t.getLines=function(){return e},t.size=function(){return e.length},t.getStop=function(){var t=e.length-1;return t>=0?e[t].getStop():void 0},t.get=function(t){return e[t]},t.getStart=function(){return e.length?e[0].getStart():null},t.moveTo=function(r){if(e.length>0)throw"started path must not be moved no more";return n=r,t},t.lineTo=function(r,o){if(null==n)return t.moveTo(r);if(r=o?r:t.getEqualPoint(r)||r,n==r)return t;var i=h.create(n,r);return n=r,e.push(i),t},t.close=function(){var n=t.getStart();return t.lineTo(n,!0)},t.isClosed=function(){if(e.length<2)return!1;var n=t.getStart(),r=t.getStop();return n==r},t.getPointer=function(){return n},t.scale=function(n,e){return r=!r,t.scaleAndMark(n,e,r),t},t.scaleAndMark=function(n,r,o){return!t.isMarkedAs(o)&&e.length&&(t.markAs(o),t.forEach(function(t){t.scaleAndMark(n,r,o)})),t},t.translate=function(n,e){return r=!r,t.translateAndMark(n,e,r),t},t.translateAndMark=function(n,e,r){return t.isMarkedAs(r)||(t.markAs(r),t.forEach(function(t){t.translateAndMark(n,e,r)})),t},t.transform=function(n){return r=!r,t.transformAndMark(n,r)},t.transformAndMark=function(n,e){return t.isMarkedAs(e)||(t.markAs(e),t.forEach(function(t){t.transformAndMark(n,e)})),t},t.backup=function(){for(var r=0;r<e.length;r++)e[r].backup();return null!=n&&n.backup(),t},t.restore=function(){for(var r=0;r<e.length;r++)e[r].restore();return null!=n&&n.restore(),t},t.getType=function(){return f.PATH},t.toJson=function(){var n=[];return t.forEach(function(t){n.push(t.toJson())},!1,!0),n},t.toGeoJson=function(){return{type:"LineString",coordinates:t.toJson()}},t.copy=function(){var n=v.create();if(e.length>0){n.moveTo(t.getStart().copy());for(var r=t.isClosed(),o=r?e.length-1:e.length,i=0;o>i;i++){var a=e[i].getStop();n.lineTo(a.copy())}r&&n.close()}return n};var o=function(t){for(var n=null,r=0;r<e.length;r++){var o=t(e[r]);n=null==n?o:y(n,o)}return n};return t.distanceTo=function(t,n){return o(function(e){return e.distanceTo(t,n)})},t.distanceToPoint=function(n){return t.distanceTo(n.getX(),n.getY())},t.distanceToBox=function(t){return o(function(n){return n.distanceToBox(t)})},t.distanceToLine=function(t){return o(function(n){return n.distanceToLine(t)})},t.distanceToPath=function(t){return o(function(n){return t.distanceToLine(n)})},t.contains=function(t,n){return e.some(function(e){return e.contains(t,n)})},t.containsPoint=function(n){return t.contains(n.getX(),n.getY())},t.intersectsBox=function(t){return e.some(function(n){return n.intersectsBox(t)})},t.intersectsLine=function(t){return e.some(function(n){return n.intersectsLine(t)})},t.intersectsPath=function(t){return e.some(function(n){return t.intersectsLine(n)})},t.computeBoundingBox=function(n){if(0==e.length)throw"empty path has no bounding box";var r=t.getStart();n.set(r,r);for(var o=0;o<e.length;o++){var i=e[o].getStop();n.stretchToContain(i)}return n},t.forEach=function(t,r,o){var i=e.length;if(i){var a;if(!o&&n&&t(n),r)for(t(e[i-1].getStop()),a=i-1;a>=0;a--)t(e[a].getStart());else for(t(e[0].getStart()),a=0;i>a;a++)t(e[a].getStop())}},t.getEqualPoint=function(t){if(n&&n.equals(t))return n;if(e.length){var r=e[0].getStart();if(r.equals(t))return r;for(var o=0;o<e.length;o++){var i=e[o],a=i.getStop();if(a.equals(t))return a}}},t},fromJson:function(t){var n=v.create();if(t.length){var e=l.fromJson(t[0]);n.moveTo(e);for(var r=1;r<t.length;r++){var o=l.fromJson(t[r]);n.lineTo(o)}n.getStart().equals(n.getStop())&&n.close()}return n},fromGeoJson:function(t){return v.fromJson(t.coordinates)}},p={create:function(){var t=s(),n=[],e=!0;t.addPath=function(e){if(!e.isClosed())throw"only closed paths can be added to a polygon!";return n.push(e),t},t.getPaths=function(){return n},t.scale=function(n,r){return e=!e,t.scaleAndMark(n,r,e)},t.scaleAndMark=function(e,r,o){if(!t.isMarkedAs(o)){t.markAs(o);for(var i=0;i<n.length;i++)n[i].scaleAndMark(e,r,o)}return t},t.translate=function(n,r){return e=!e,t.translateAndMark(n,r,e)},t.translateAndMark=function(e,r,o){if(!t.isMarkedAs(o)){t.markAs(o);for(var i=0;i<n.length;i++)n[i].translateAndMark(e,r,o)}return t},t.transform=function(n){return e=!e,t.transformAndMark(n,e)},t.transformAndMark=function(e,r){if(!t.isMarkedAs(r)){t.markAs(r);for(var o=0;o<n.length;o++)n[o].transformAndMark(e,r)}return t},t.backup=function(){for(var e=0;e<n.length;e++)n[e].backup();return t},t.restore=function(){for(var e=0;e<n.length;e++)n[e].restore();return t},t.getType=function(){return f.POLYGON},t.toJson=function(){for(var t=[],e=0;e<n.length;e++)t[e]=n[e].toJson();return t},t.toGeoJson=function(){return{type:"Polygon",coordinates:t.toJson()}},t.copy=function(){for(var t=p.create(),e=0;e<n.length;e++)t.addPath(n[e].copy());return t};var r=function(t){for(var e=null,r=0;r<n.length;r++){var o=t(n[r]);e=null==e?o:y(e,o)}return e};t.existsPath=function(t){return n.some(t)},t.contains=function(t,e){for(var r=!1,i=0;i<n.length;i++)for(var a=n[i].getLines(),u=0;u<a.length;u++){var c=a[u];o(t,e,c)&&(r=!r)}return r};var o=function(t,n,e){var r=e.getStart(),o=e.getStop(),i=r.getX(),a=o.getX();if(t>i==t>a)return!1;var u=r.getY(),c=o.getY();if(n<Math.min(u,c))return!0;var f=(c-u)/(a-i),s=f*(t-i)+u;return s>n};return t.containsPoint=function(n){return t.contains(n.getX(),n.getY())},t.intersectsBox=function(e){return t.contains(e.getLeft(),e.getTop())||n.some(function(t){return t.intersectsBox(e)})},t.intersectsLine=function(e){return t.containsPoint(e.start)||n.some(function(t){return t.intersectsLine(e)})},t.intersectsPath=function(e){return t.containsPoint(e.getStart())||n.some(function(t){return t.intersectsPath(e)})},t.intersectsPolygon=function(e){return e.existsPath(function(n){return t.containsPoint(n.getStart())})||n.some(function(t){return e.intersectsPath(t)})},t.distanceTo=function(t,n){return r(function(e){return e.distanceTo(t,n)})},t.distanceToPoint=function(n){return t.distanceTo(n.getX(),n.getY())},t.distanceToBox=function(t){return r(function(n){return n.distanceToBox(t)})},t.distanceToLine=function(t){return r(function(n){return n.distanceToLine(t)})},t.distanceToPath=function(t){return r(function(n){return n.distanceToPath(t)})},t.distanceToPolygon=function(t){return r(function(n){return t.distanceToPath(n)})},t.computeBoundingBox=function(t){if(0==n.length)throw"empty polygon has no bounding box";var e=n[0].getLines()[0].getStart();t.set(e,e);for(var r=0;r<n.length;r++){var o=n[r],i=o.getLines(),a=i[0].getStart();t.stretchToContain(a);for(var u=0;u<i.length;u++){var c=i[u].getStop();t.stretchToContain(c)}}return t},t},fromJson:function(t){for(var n=p.create(),e=0;e<t.length;e++){var r=v.fromJson(t[e]);n.addPath(r.close())}return n},fromGeoJson:function(t){return p.fromJson(t.coordinates)}},m=function(t,n,e,o,i){void 0===i&&(i=r(t,n,e,o));var a={x:t,y:n},u={x:e,y:o};return{pixels:i,a:a,b:u,otherX:function(n){return n==t?e:t},otherY:function(t){return t==n?o:n},other:function(e){return e.x==t&&e.y==n?u:a}}},y=function(t,n){return n.pixels<t.pixels?n:t},T=function(t,n,e,r){return y(y(t,n),y(e,r))};n.exports={Type:f,Point:l,Box:d,Circle:g,Line:h,Path:v,Polygon:p}},{}],13:[function(t,n,e){var r=t("./geometry"),o={},i={};i[r.Type.POINT]=function(t,n){return t.containsPoint(n)},i[r.Type.CIRCLE]=function(t,n){return n.containsPoint(t)},i[r.Type.BOX]=function(t,n){return n.containsPoint(t)},i[r.Type.LINE]=function(t,n){return n.containsPoint(t)},i[r.Type.PATH]=function(t,n){return n.containsPoint(t)},i[r.Type.POLYGON]=function(t,n){return n.containsPoint(t)};var a={};a[r.Type.POINT]=function(t,n){return t.containsPoint(n)},a[r.Type.CIRCLE]=function(t,n){return t.intersectsGeometry(n)},a[r.Type.BOX]=function(t,n){return t.intersectsGeometry(n)},a[r.Type.LINE]=function(t,n){return t.intersectsGeometry(n)},a[r.Type.PATH]=function(t,n){return t.intersectsGeometry(n)},a[r.Type.POLYGON]=function(t,n){return t.intersectsGeometry(n)};var u={};u[r.Type.POINT]=function(t,n){return t.containsPoint(n)},u[r.Type.CIRCLE]=function(t,n){return n.intersectsGeometry(t)},u[r.Type.BOX]=function(t,n){return t.intersectsBox(n)},u[r.Type.LINE]=function(t,n){return n.intersectsBox(t)},u[r.Type.PATH]=function(t,n){return n.intersectsBox(t)},u[r.Type.POLYGON]=function(t,n){return n.intersectsBox(t)};var c={};c[r.Type.POINT]=function(t,n){return t.containsPoint(n)},c[r.Type.CIRCLE]=function(t,n){return n.intersectsGeometry(t)},c[r.Type.BOX]=function(t,n){return t.intersectsBox(n)},c[r.Type.LINE]=function(t,n){return t.intersectsLine(n)},c[r.Type.PATH]=function(t,n){return n.intersectsLine(t)},c[r.Type.POINT]=function(t,n){return n.intersectsLine(t)};var f={};f[r.Type.POINT]=function(t,n){return t.containsPoint(n)},f[r.Type.CIRCLE]=function(t,n){return n.intersectsGeometry(t)},f[r.Type.BOX]=function(t,n){return t.intersectsBox(n)},f[r.Type.LINE]=function(t,n){return t.intersectsLine(n)},f[r.Type.PATH]=function(t,n){return t.intersectsPath(n)},f[r.Type.POLYGON]=function(t,n){return n.intersectsPath(t)};var s={};s[r.Type.POINT]=function(t,n){return t.containsPoint(n)},s[r.Type.CIRCLE]=function(t,n){return n.intersectsGeometry(t)},s[r.Type.BOX]=function(t,n){return t.intersectsBox(n)},s[r.Type.LINE]=function(t,n){return t.intersectsLine(n)},s[r.Type.PATH]=function(t,n){return t.intersectsPath(n)},s[r.Type.POLYGON]=function(t,n){return t.intersectsPolygon(n)},o[r.Type.POINT]=i,o[r.Type.CIRCLE]=a,o[r.Type.BOX]=u,o[r.Type.LINE]=c,o[r.Type.PATH]=f,o[r.Type.POLYGON]=s;var l=o;o={},i={},i[r.Type.POINT]=function(t,n){return t.distanceToPoint(n)},i[r.Type.CIRCLE]=function(t,n){return n.distanceToPoint(t)},i[r.Type.BOX]=function(t,n){return n.distanceToPoint(t)},i[r.Type.LINE]=function(t,n){return n.distanceToPoint(t)},i[r.Type.PATH]=function(t,n){return n.distanceToPoint(t)},i[r.Type.POLYGON]=function(t,n){return n.distanceToPoint(t)},a={},a[r.Type.POINT]=function(t,n){return t.distanceToPoint(n)},a[r.Type.CIRCLE]=function(t,n){return t.distanceToGeometry(n)},a[r.Type.BOX]=function(t,n){return t.distanceToGeometry(n)},a[r.Type.LINE]=function(t,n){return t.distanceToGeometry(n)},a[r.Type.PATH]=function(t,n){return t.distanceToGeometry(n)},a[r.Type.POLYGON]=function(t,n){return t.distanceToGeometry(n)},u={},u[r.Type.POINT]=function(t,n){return t.distanceToPoint(n)},u[r.Type.CIRCLE]=function(t,n){return n.distanceToGeometry(t)},u[r.Type.BOX]=function(t,n){return t.distanceToBox(n)},u[r.Type.LINE]=function(t,n){return n.distanceToBox(t)},u[r.Type.PATH]=function(t,n){return n.distanceToBox(t)},u[r.Type.POLYGON]=function(t,n){return n.distanceToBox(t)},c={},c[r.Type.POINT]=function(t,n){return t.distanceToPoint(n)},c[r.Type.CIRCLE]=function(t,n){return n.distanceToGeometry(t)},c[r.Type.BOX]=function(t,n){return t.distanceToBox(n)},c[r.Type.LINE]=function(t,n){return t.distanceToLine(n)},c[r.Type.PATH]=function(t,n){return n.distanceToLine(t)},c[r.Type.POINT]=function(t,n){return n.distanceToLine(t)},f={},f[r.Type.POINT]=function(t,n){return t.containsPoint(n)},f[r.Type.CIRCLE]=function(t,n){return n.distanceToGeometry(t)},f[r.Type.BOX]=function(t,n){return t.distanceToBox(n)},f[r.Type.LINE]=function(t,n){return t.distanceToLine(n)},f[r.Type.PATH]=function(t,n){return t.distanceToPath(n)},f[r.Type.POLYGON]=function(t,n){return n.distanceToPath(t)},s={},s[r.Type.POINT]=function(t,n){return t.containsPoint(n)},s[r.Type.CIRCLE]=function(t,n){return n.distanceToGeometry(t)},s[r.Type.BOX]=function(t,n){return t.distanceToBox(n)},s[r.Type.LINE]=function(t,n){return t.distanceToLine(n)},s[r.Type.PATH]=function(t,n){return t.distanceToPath(n)},s[r.Type.POLYGON]=function(t,n){return t.distanceToPolygon(n)},o[r.Type.POINT]=i,o[r.Type.CIRCLE]=a,o[r.Type.BOX]=u,o[r.Type.LINE]=c,o[r.Type.PATH]=f,o[r.Type.POLYGON]=s;var g=o,d=function(t,n){var e=t.getType(),r=n.getType(),o=g[e][r];return o(t,n)},h=function(t,n){if(!m(t,n))return!1;var e=t.getType(),r=n.getType(),o=l[e][r];return o(t,n)},v=r.Box.empty(),p=r.Box.empty(),m=function(t,n){return t.computeBoundingBox(v),n.computeBoundingBox(p),v.intersectsBox(p)},y=function(t){switch(t.type.toLowerCase()){case"point":return r.Point.fromGeoJson(t);case"circle":return r.Circle.fromGeoJson(t);case"envelope":return r.Box.fromGeoJson(t);case"multipoint":return r.Line.fromGeoJson(t);case"linestring":return r.Path.fromGeoJson(t);case"polygon":return r.Polygon.fromGeoJson(t)}throw"unsupported GeoJson-Type: "+t.type},T=r.Box.empty(),x=function(t){var n=t.getType();if(n==r.Type.POINT)return[t.getX(),t.getY()];if(n==r.Type.POLYGON)return M(t);if(n==r.Type.CIRCLE){var e=t.getCenter();return[e.getX(),e.getY()]}if(n==r.Type.BOX)return[t.getLeft()+t.getWidth()/2,t.getTop()+t.getHeight()/2];if(n==r.Type.PATH){var o=Math.floor((t.size()+1)/2)-1,i=t.get(o);return i=i.getStart(),[i.getX(),i.getY()]}throw"unsupported geo-type to compute center: "+n},M=function(t){t.computeBoundingBox(T);for(var n=null,e=0,r=T.getLeft(),o=T.getTop(),i=T.getWidth(),a=T.getHeight(),u=0;100>u;u++){var c=r+Math.random()*i,f=o+Math.random()*a;if(t.contains(c,f)){if(n){var s=1/e;n[0]=(1-s)*n[0]+s*c,n[1]=(1-s)*n[1]+s*f}else n=[c,f];e++}}return n||(n=[r+i/2,f+a/2]),n};n.exports={fromGeoJson:y,intersect:h,distance:d,computeCenter:x}},{"./geometry":12}],14:[function(t,n,e){var r=t("commons"),o=t("geometry/artist"),i=t("./tools"),a=t("geometry/geometry"),u=(t("client/fiat"),function(){var t,n,e,u,f,s,l={},g=[],d=0,h=0,v=0,p=null,m=[],y=!1;l.clear=function(){g=[],t&&I()},l.onGeometry=function(t){m.push(t)},l.offGeometry=function(t){return r.removeElement(m,t)},l.addGeometry=function(n,e){if(n.getType()==a.Type.PATH&&n.size()<1)throw"a path with no lines must not be added to the designer";var r=n.copy();r.origin=n,r.transform(i.mercator),r.backup(),P(r),g.push(r),t&&I(),e&&m.forEach(function(t){t(n)})},l.removeGeometry=function(n){r.remove(g,function(t){return t.origin===n}),t&&I()},l.getGeometry=function(t){if(t=t||0,t>=g.length)return null;var n=g[t];return n.origin};var T=function(n,e,r){null!=p&&p.from.origin==n||(p={showCircle:r},p.from=n.copy().transform(i.mercator).backup(),p.from.origin=n,P(p.from),p.to=e.copy().backup()),p.to.restore().set(e.getX(),e.getY()).backup(),P(p.to),t&&I()},x=function(){p=null,t&&I()},M=function(t){if(p){var n=p.to.getX()-p.from.getX(),e=p.to.getY()-p.from.getY();return t&&(n/=d,e/=d),Math.sqrt(n*n+e*e)}};l.update=function(){d=s.getSize(),h=-s.getX()*d,v=-s.getY()*d;for(var t=0;t<g.length;t++){var n=g[t];P(n)}null!=p&&(P(p.from),P(p.to))};var P=function(t){t.restore(),t.backup(),t.scale(d,d),t.translate(h,v)};l.initialize=function(r){s=r;var i=s.container.box(),a=l.canvas.raw();n=a.width=i.width,e=a.height=i.height,t=a.getContext("2d"),f=o(t),s.onTap(L),s.onHover(S)};var w,L=function(t,n){if(null!=H&&H.onTap)return t=A(t),H.onTap(t,n),!1;var e=k(t);return e&&e.onTap?e.onTap():void I()},S=function(t,n){if(null!=H&&H.onHover)return t=A(t),H.onHover(t,n),!1;var e=k(t);return e!=w?(w&&w.onOut&&w.onOut(),w=e,w&&w.onOver&&w.onOver(),I(),!1):void 0},b=a.Point.create(0,0),k=function(t){if(g.length){b.set(t.x,t.y);var n,e=cmToPx(.5);return g.forEach(function(t){var r=t.distanceToPoint(b).pixels;e>r&&(!n||n.value>r)&&(n={value:r,geo:t})}),n&&n.geo.origin}},A=function(t){var n=(t.x-h)/d,e=(t.y-v)/d;return a.Point.create(n,e)};l.render=function(){if(u=null,t.clearRect(0,0,n,e),!y)for(var r=0;r<g.length;r++){var o=g[r];f.setColor(o.origin.color||"#303030"),f.setColor(o.origin.colorBright||"#f3f3f3",!0),f.draw(g[r],!0)}null!=p&&C()},l.setGeosHidden=function(t){return y=t,I(),l};var I=function(){u=u||window.requestAnimationFrame(l.render)};l.triggerUpdate=I;var C=function(){var t=p.from,n=p.to;p.showCircle&&E(t),Y(t,n),D(t,n)},E=function(n){var e=M();t.beginPath(),t.arc(n.getX(),n.getY(),e,0,X,!1),f.fillWithAlpha(.6)},O=cmToPx(.2),N=cmToPx(.1),G=Math.round(cmToPx(.2)),B=Math.round(cmToPx(.05)),X=2*Math.PI,Y=function(n,e){t.beginPath(),t.moveTo(n.getX(),n.getY()),t.lineTo(e.getX(),e.getY()),t.lineWidth=G;var r=t.getLineDash();t.setLineDash([O,N]),t.stroke(),t.setLineDash(r),f.draw(n),f.draw(e)},D=function(n,e){var r=((e.getY()-n.getY())/2+n.getY()-v)/d,o=M(),a=Math.round(o*i.metersPerPixel(r,d))+"m";t.fillStyle="#303030";var u=G,f=e.getX()+u,s=e.getY()-u,l=t.measureText(a).width+2*u,g=20;c(f,s-g,l,g,u,t),t.fillStyle="#ffffff",t.fill(),t.lineWidth=.8*B,t.strokeStyle="#303030",t.stroke(),t.fillStyle="#303030",t.fillText(a,f+l/2,s-g/2)},H=null,J=function(){H&&(H.onStop&&H.onStop(),H=null,I())},R=function(t){H!=t&&(J(),H=t)},z=function(){var t={};return t.onTap=function(t){var n=t.copy();n.transform(i.inverseMercator),l.addGeometry(n,!0),J()},t},q=function(){var t,n,e={};return e.onStop=function(){x(),n=null,null!=t&&(l.removeGeometry(t),t=null)},e.onTap=function(e){if(null==t)t=e.copy(),t.transform(i.inverseMercator),l.addGeometry(t);else{if(n=M(!0),n>0){l.removeGeometry(t);var r=t.copy().transform(i.mercator);n=i.inverseMercator.transformDistance(n,r);var o=a.Circle.create(t,n);t=null,l.addGeometry(o,!0)}J()}},e.onHover=function(n,e){null==t||e||T(t,n,!0)},e},U=function(){var t,n={};return n.finalize=function(){if(t&&t.size()>0){if(l.removeGeometry(t),n.isPolygon){t.close();var e=a.Polygon.create();e.addPath(t),l.addGeometry(e,!0)}else l.addGeometry(t,!0);t=null}J()},n.onStop=function(){x(),null!=t&&(l.removeGeometry(t),t=null)},n.onTap=function(e,r){t&&r>1?n.finalize():t?(e=e.copy(),e.transform(i.inverseMercator),l.removeGeometry(t),t.lineTo(e),l.addGeometry(t)):(e=e.copy(),e.transform(i.inverseMercator),t=a.Path.create(),t.moveTo(e),l.addGeometry(t))},n.onHover=function(n,e){if(t&&!e){var r=t.getPointer();T(r,n)}},n},W=function(){var t=U();return t.isPolygon=!0,t},F=function(t){return function(){R(t)}};return l.point=F(z()),l.circle=F(q()),l.path=F(U()),l.polygon=F(W()),l.stop=J,l}),c=function(t,n,e,r,o,i){return 2*o>e&&(o=e/2),2*o>r&&(o=r/2),i.beginPath(),i.moveTo(t+o,n),i.arcTo(t+e,n,t+e,n+r,o),i.arcTo(t+e,n+r,t,n+r,o),i.arcTo(t,n+r,t,n,o),i.arcTo(t,n,t+e,n,o),i.closePath(),this};n.exports={layer:u}},{"./tools":17,"client/fiat":5,commons:10,"geometry/artist":11,"geometry/geometry":12}],15:[function(t,n,e){var r=t("client/fiat"),o=t("client/animation"),i=t("geometry"),a=t("client/touches"),u=t("./tools"),c=t("commons"),f=function(){var t={};t.container=r.node("div").style({cursor:"pointer",position:"relative"});var n,e,f,s,l,g,d=[];t.getSize=function(){return e*e},t.getX=function(){return n.x},t.getY=function(){return n.y},t.toLocation=function(e,r,o){o=o||i.Point.create(e,r);var a=t.getSize();return o.set(n.x+e/a,n.y+r/a).transform(u.inverseMercator)},t.getBox=function(e){var r=t.getSize();return e.setBox(n.x,n.y,s/r,l/r)};var h=function(t){return Math.max(g,t)},v=function(t,n){var e=0,r=1-s/n;return Math.max(e,Math.min(r,t))},p=function(t,n){var e=0,r=1-l/n;return Math.max(e,Math.min(r,t))},m=function(){f=f||window.requestAnimationFrame(y)},y=function(){f=null;for(var t=0;t<d.length;t++)d[t].render()},T=function(){var t;for(t=0;t<d.length;t++)d[t].update();for(t=0;t<I.length;t++)I[t]();m()},x=function(){return r.node("canvas").style({position:"absolute",left:0,top:0,width:"100%",height:"100%"})};t.addLayer=function(n){return n.canvas=x(),d.push(n),t.container.append(n.canvas),t.attached&&(E(n),n.initialize(t),n.update(),window.requestAnimationFrame(n.render)),t},t.removeLayer=function(n){return c.removeElement(d,n),n.canvas.remove(),t};var M,P=function(e){var r=e.xpms>0,i=e.ypms>0,a=(new Date).getTime(),u=!1,c=!1,f={doLoop:function(o){var f=o-a;a=o;var s=t.getSize();if(!u){var l=f*e.xpms;n.x=v(n.x-l/s,s),e.xpms-=.005*f*e.xpms,u=r!=e.xpms>0||Math.abs(e.xpms)<.01}if(!c){var g=f*e.ypms;n.y=p(n.y-g/s,s),e.ypms-=.005*f*e.ypms,c=i!=e.ypms>0||Math.abs(e.ypms)<.01}return T(),u&&c}};M&&M.cancel(),M=o.loop(f)},w=function(r,i){var a={from:0,to:1,duration:2e3,onTick:function(o){var a=t.getSize(),u=s/2-(i.x-n.x)*a,c=l/2-(i.y-n.y)*a;e=h(e+(r-e)*o*o),a=t.getSize(),n.x=v(i.x-(s/2-u*(1-o))/a,a),n.y=p(i.y-(l/2-c*(1-o))/a,a),T()},onDone:function(){M=null}};null!=M&&M.cancel(),M=o.start(a)};t.goTo=function(r,o,i){if(i)w(r,o);else{e=h(r);var a=t.getSize();n.x=v(o.x-s/2/a,a),n.y=p(o.y-l/2/a,a),T()}};var L=1/(1<<17),S=function(n,e){var r=0==n.getWidth()?L:n.getWidth(),o=0==n.getHeight()?L:n.getHeight(),i=Math.sqrt((s-cmToPx(1))/r),a=Math.sqrt((l-cmToPx(1))/o),u=Math.min(i,a),c={x:n.getLeft()+n.getWidth()/2,y:n.getTop()+n.getHeight()/2};t.goTo(u,c,e)};t.goToGeo=function(t,n){t=t.copy().transform(u.mercator);var e=i.Box.empty();t.computeBoundingBox(e),S(e,n)},t.goToUser=function(n){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){e=e.coords;var r=e.latitude,o=e.longitude,a=i.Point.create(o,r);t.goToGeo(a,n)})};var b=!1;a.listen(t.container,{onWheel:function(r,o){var i=t.getSize();e=h(e+e*o*.04);var a=t.getSize(),u=1/i-1/a;return n.x=v(n.x+r.x*u,a),n.y=p(n.y+r.y*u,a),T(),!1},onPan:function(e,r,o){b=!1;var i=r.x-o.x,a=r.y-o.y,u=t.getSize();return n.x=v(n.x+i/u,u),n.y=p(n.y+a/u,u),T(),!1},onSwipe:function(t,n){P(n)},onDown:function(){b=!0,M&&M.cancel()},onTap:function(t,n){b=!1;for(var e=k.length-1;e>=0;e--)if(0==k[e](t,n))return!1},onHover:function(t){for(var n=A.length-1;n>=0;n--)if(0==A[n](t,b))return!1}});var k=[],A=[],I=[];t.onTap=function(t){k.push(t)},t.onHover=function(t){A.push(t)},t.onUpdate=function(t){I.push(t)};var C=function(){var n=t.container.box();s=n.width,l=n.height,g=Math.sqrt(Math.max(s,l)),d.forEach(function(t){E(t,n)})},E=function(n,e){e=e||t.container.box();var r=n.canvas,o=r.raw();n.width=o.width=e.width,n.height=o.height=e.height,n.context=n.context||o.getContext("2d")};return t.container.onAttached(function(){C(),e=h(1);var r=t.getSize();n={x:v(.2,r),y:p(.2,r)},d.forEach(function(n){n.initialize(t)}),t.attached=!0,T()}),t.onResize=function(){C(),T()},t.triggerUpdate=T,t};n.exports={create:f}},{"./tools":17,"client/animation":4,"client/fiat":5,"client/touches":8,commons:10,geometry:12}],16:[function(t,n,e){var r=t("client/fiat"),o=t("commons"),i=t("client/animation"),a=t("./tools"),u=t("geometry"),c=t("geometry/artist"),f=function(t){var n,e,r,o={},i=[],a=0;o.setProvider=function(n){if(t=n,o.context){var r=Math.max(o.width,o.height)/t.tileSize;r=Math.round(Math.pow(r,8)),e=g(r,t,s)}},o.initialize=function(e){o.setProvider(t),n=e},o.update=function(){e.onUpdateStart(),u(),e.onUpdateStop()};var u=function(){var r=n.getSize(),u=Math.ceil(r/t.tileSize),f=Math.round(Math.log(u)/Math.log(2));f=Math.min(t.max,Math.max(t.min,f)),u=1<<f,a=r/u;var s=n.getX()*r,l=n.getY()*r,g=Math.floor(s/a),d=Math.floor(l/a),h=Math.ceil(o.width/a)+1,v=Math.ceil(o.height/a)+1;h=Math.min(h,u-g),v=Math.min(v,u-d),c(h*v);for(var p=0;h>p;p++)for(var m=0;v>m;m++){var y=i[p*v+m];y.update((g+p)*a-s,(d+m)*a-l,e.get(g+p,d+m,f))}},c=function(t){for(;i.length>t;)i.pop();for(;i.length<t;)i.push(f())},f=function(){var t={left:0,top:0,tile:null};return t.update=function(n,e,r){t.left=n,t.top=e,t.tile=r},t},s=function(){r=r||window.requestAnimationFrame(o.render)};return o.render=function(){r=null,o.context.clearRect(0,0,o.width,o.height),e.onDrawStart();for(var t=0;t<i.length;t++){var n=i[t],u=n.tile;u.draw(o.context,n.left,n.top,a,!1)}e.onDrawStop()},o.clearCache=function(){e.clear()},o},s={MAPQUEST:{tileSize:256,getUrl:function(t,n,e){var r=Math.round(3*Math.random()+1);return"http://otile"+r+".mqcdn.com/tiles/1.0.0/osm/"+e+"/"+t+"/"+n+".jpg"},min:1,max:19},GOOGLE:{tileSize:256,getUrl:function(t,n,e){var r=Math.round(2*Math.random()+1),o="m@169000000",i="de";
return"http://mt"+r+".google.com/vt/lyrs="+o+"&hl="+i+"&x="+t+"&y="+n+"&z="+e+"&s=Galileo"},min:1,max:20},DSS:function(){var t=1;return{tileSize:256,getUrl:function(n,e,r){return"/tiles/"+n+"/"+e+"/"+r+"&"+t},min:1,max:20,clear:function(){t++}}}()},l=2,g=function(t,n,e){var r=o.LruCache(t),a={};a.clear=function(){r=o.LruCache(t)},a.onUpdateStart=function(){r.forEach(f)},a.get=function(t,e,o){var i=d(t,e,o),a=r.get(i);return a||(a=h(t,e,o,n),u(a,l),r.put(i,a,!1)),c(a,l),a},a.onUpdateStop=function(){r.shrink()},r.onDismiss=function(t,n){n.cancel()},a.onDrawStart=function(){r.forEach(s)},a.onDrawStop=function(){r.forEach(g)};var u=function(t,e){var o=t.z,i=t.x,a=t.y;if(o>0&&e>0&&!t.parent){o--,i=Math.floor(i/2),a=Math.floor(a/2);var c=d(i,a,o),f=r.getSilently(c);f||(f=h(i,a,o,n),r.put(c,f,!1)),t.parent=f,u(f,e-1)}},c=function(t,n){t.pinned||(t.pinned=!0,t.parent&&n&&c(t.parent,n-1))},f=function(t){var n=t.value;n.pinned=!1},s=function(t){var n=t.value;n.drawn=!1},g=function(t){var n=t.value;n.drawn||n.cancel()},h=function(t,n,r,o){var a,u={x:t,y:n,z:r,alpha:0},c=o.tileSize,f=function(t,n,e,r){t.drawImage(u.image,0,0,c,c,n,e,r,r)},s=function(t,n,e,r,o,i){u.drawn=!o||u.image,u.image||(a&&clearTimeout(a),a=setTimeout(h,100)),u.alpha>=1?f(t,n,e,r):o?u.alpha>0?f(t,n,e,r):u.parent&&i&&g(t,n,e,r,i-1):(u.parent&&g(t,n,e,r),u.alpha>0&&d(t,n,e,r))},g=function(t,n,e,r,o){t.save(),t.beginPath(),t.rect(n,e,r,r),t.clip();var i=u.x%2==1?r:0,a=u.y%2==1?r:0;u.parent.draw(t,n-i,e-a,2*r,2*r,!0,o),t.restore()},d=function(t,n,e,r){var o=t.globalAlpha;t.globalAlpha=o*u.alpha,f(t,n,e,r),t.globalAlpha=o},h=function(){a=null,u.image=new Image,u.image.onload=function(){u.ready=!0,i.tween({from:0,to:1,onTick:function(t){u.alpha=t,e()}})},u.image.src=o.getUrl(t,n,r)};return u.draw=function(t,n,e,r,o){s(t,n,e,r,o,l)},u.cancel=function(){return a?(clearTimeout(a),a=null,!0):void 0},u};return a},d=function(t,n,e){return t+"_"+n+"_"+e},h=1/65536/256,v=function(t){t=t||{};var n,e=function(t,e){t||(e=!0,t=u.Box.create(u.Point.create(0,0),u.Point.create(1,1))),e||(t=t.copy().transform(a.mercator)),n=t};e(t.geo,t.transformed);var o=t.offset||1,i=t.provider||s.MAPQUEST,f=r.node("div").style("position","relative"),l={position:"absolute",left:0,top:0,height:"100%",width:"100%"},g=r.node("canvas").style(l),d=r.node("canvas").style(l);f.append(g,d);var v,p,m,y,T,x=function(){m.clearRect(0,0,v,p),y.clearRect(0,0,v,p);var e=u.Box.empty();n.computeBoundingBox(e);var r=e.getWidth()/(v-cmToPx(o)),i=e.getHeight()/(p-cmToPx(o)),a={};a.scale=Math.max(h,Math.max(r,i)),a.width=v*a.scale,a.height=p*a.scale,a.x=e.getLeft()-(a.width-e.getWidth())/2,a.y=e.getTop()-(a.height-e.getHeight())/2,P(a),w(a),t.hideGeo||L(a)},M=function(t,n,e){return Math.max(n,Math.min(e,t))},P=function(t){t.x=M(t.x,0,1),t.y=M(t.y,0,1),t.width=Math.min(1-t.x,t.width),t.height=Math.min(1-t.y,t.height);var n=t.width/v,e=t.height/p;t.scale=Math.max(n,e)},w=function(t){var n=Math.max(t.width,t.height),e=Math.floor(Math.log(1/n)/Math.log(2));e=Math.min(i.max,Math.max(i.min,e));for(var r=Math.pow(2,e),o=1/r,a=Math.ceil(t.width/o)+1,u=Math.ceil(t.height/o)+1,c=Math.floor(t.x/o),f=Math.floor(t.y/o),s=0;a>s;s++)for(var l=0;u>l;l++){var g={x:c+s,y:f+l,z:e};g.x<r&&g.y<r&&S(g,t,o)}},L=function(t){n.backup();var e=1/t.scale;n.translate(-t.x,-t.y),n.scale(e,e),T.draw(n),n.restore()},S=function(t,e,r){var o=new Image,a=n;o.onload=function(){if(a==n){var i=(t.x*r-e.x)/e.scale,u=(t.y*r-e.y)/e.scale,c=r/e.scale;m.drawImage(o,0,0,256,256,i,u,c,c)}},o.src=i.getUrl(t.x,t.y,t.z)};f.onAttached(function(){m=b(g),y=b(d),T=c(y,t.artist),x()});var b=function(t){var n=t.raw(),e=t.box();return v=n.width=e.width,p=n.height=e.height,n.getContext("2d")};return f.update=function(t,n){e(t,n),T&&x()},f};n.exports={layer:f,image:v,providers:s}},{"./tools":17,"client/animation":4,"client/fiat":5,commons:10,geometry:12,"geometry/artist":11}],17:[function(t,n,e){var r=6378137,o=Math.PI/180,i=2*Math.PI*r,a={transformPoint:function(t){var n=t.getY(),e=t.getX(),r=Math.sin(n*o),i=(1+r)/(1-r),a=(e+180)/360,u=.5-Math.log(i)/(4*Math.PI);t.set(a,u)},transformDistance:function(t,n){return t/360}},u={transformPoint:function(t){var n=t.getX()-.5,e=.5-t.getY(),r=90-360*Math.atan(Math.exp(2*-e*Math.PI))/Math.PI,o=360*n;t.set(o,r)},transformDistance:function(t,n){return 360*t}},c=function(t,n){return t*(360/(Math.cos(n*Math.PI/180)*i))},f=function(t,n){return t*(Math.cos(n*Math.PI/180)*i/360)},s=function(t,n){return Math.cos(t*Math.PI/180)*i/n},l=function(t,n){var e=.5>t?t/.5:(1-t)/.5,r=e*i;return r/n};n.exports={mercator:a,inverseMercator:u,meterToRadians:c,radiansToMeters:f,metersPerPixel:l,groundResolution:s}},{}]},{},[1]);
//# sourceMappingURL=script_min.js.map